<!DOCTYPE html>
<html>
<head>
    <title>coffee order</title>
</head>
<body>
    <h2>coffee order</h2>
    <form id="orderForm">
        <label>name: <input type="text" name="name" required></label><br><br>

        <label>caffeine:</label>
        <label><input type="radio" name="caffeine" value="espresso" required> espresso</label>
        <label><input type="radio" name="caffeine" value="matcha"> matcha</label><br><br>

        <label><input type="radio" name="temp" value="hot" required> hot</label>
        <label><input type="radio" name="temp" value="cold"> cold</label><br><br>

        <label><input type="checkbox" name="milk"> milk?</label><br><br>

        <button type="submit">submit</button>
    </form>
    
    <p id="status"></p>

    <script>
        const form = document.getElementById('orderForm');
        const status = document.getElementById('status');
        
        form.addEventListener('submit', async function(e){
            e.preventDefault();
            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            const data = new FormData(form);
            const order = {
                name: data.get('name'),
                caffeine: data.get('caffeine'),
                temp: data.get('temp'),
                milk: data.get('milk') ? "milk" : "no milk",
                timestamp: Date.now(),
            };
            try {
                const res = await fetch('/tickets', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(order)
                });
                const ticket = await res.json();
                status.innerText = 'order submitted for ${ticket.name}. pls wait';
                form.reset();
            } catch(err) {
                status.innerText = "eeehhh?? try again pls";
                console.error(err);
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>